import unittest

# local imports
from ENDFtk.MF5.MT455 import GSection

class Test_ENDFtk_MF5_MT455_GSection( unittest.TestCase ) :
    """
    Unit test for the GSection class of MF5 MT455
    """

    chunkDelayed = ( " 9.223500+4 0.000000+0          6          1          0         209228 5455     \n"
   " 2.936000+2 0.000000+0         17          1        102         209228 5455     \n"
   " 0.000000+0 0.000000+0 0.000000+0 0.000000+0 0.000000+0 0.000000+09228 5455     \n"
   " 6.40367-13 1.47010-11 9.82642-12 1.40367-11 3.84615-12 1.22217-129228 5455     \n"
   " 4.42529-11 1.015916-9 6.79059-10 9.70009-10 2.65790-10 8.44587-119228 5455     \n"
   " 1.21905-10 2.798589-9 1.870633-9 2.672127-9 7.32184-10 2.32662-109228 5455     \n"
   " 3.183440-9 7.308246-8 4.884978-8 6.978001-8 1.912027-8 6.075751-99228 5455     \n"
   " 1.757545-7 4.034810-6 2.696947-6 3.852484-6 1.055611-6 3.354359-79228 5455     \n"
   " 1.836960-5 4.217127-4 2.818813-4 4.026560-4 1.103310-4 3.505928-59228 5455     \n"
   " 5.094932-4 2.641997-3 2.111820-3 3.536946-3 1.847336-3 1.259095-39228 5455     \n"
   " 2.161763-3 7.052062-3 6.968125-3 1.225451-2 5.717616-3 2.981301-39228 5455     \n"
   " 1.310483-3 3.763665-3 3.736493-3 6.518136-3 3.382608-3 1.327339-39228 5455     \n"
   " 5.424201-3 2.381035-2 2.457903-2 4.440559-2 2.164622-2 8.832828-39228 5455     \n"
   " 8.262024-3 2.873840-2 3.509891-2 6.923502-2 3.247626-2 1.292705-29228 5455     \n"
   " 1.267926-2 8.443434-2 8.189346-2 1.647387-1 6.442444-2 2.614138-29228 5455     \n"
   " 2.417905-3 1.537137-2 9.411334-3 3.265034-2 1.007016-2 4.131419-39228 5455     \n"
   " 2.188727-3 1.412648-2 7.045920-3 4.166897-2 1.314721-2 5.489045-39228 5455     \n"
   " 3.514090-5 3.337214-4 1.365560-3 1.084771-2 5.164237-3 2.801146-39228 5455     \n"
   " 0.000000+0 0.000000+0 1.490632-5 5.196002-4 5.877135-4 5.005918-49228 5455     \n" )
    
    validSEND = ( "                                                                  9228 5  0     \n" )

    def test_section( self ) :

        def verify_chunk_delayed( self, chunk ) :
            self.assertEqual( 455, chunk.MT )
            self.assertEqual( 455, chunk.section_number )
            self.assertEqual( 92235, chunk.ZA )
            self.assertEqual( 92235, chunk.target_identifier )
            self.assertEqual( 0, chunk.LR )
            self.assertEqual( 0, chunk.break_up )
            self.assertEqual( 1, chunk.NZ )
            self.assertEqual( 1, chunk.number_dilutions )
            self.assertEqual( 6, chunk.NT )
            self.assertEqual( 6, chunk.number_time_constants )
            self.assertEqual( 20, chunk.NGN )
            self.assertEqual( 20, chunk.number_neutron_groups )
            self.assertAlmostEqual( 293.6, chunk.TEMP )
            self.assertAlmostEqual( 293.6, chunk.temperature )
            self.assertAlmostEqual( 0.0, chunk.AWR )
            self.assertAlmostEqual( 0.0, chunk.atomic_weight_ratio )
            expected_lambda = [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ]
            expected_chi = [
                [ 6.40367e-13, 4.42529e-11, 1.21905e-10, 3.183440e-9, 1.757545e-7, 1.836960e-5, 5.094932e-4, 2.161763e-3,
          1.310483e-3, 5.424201e-3, 8.262024e-3, 1.267926e-2, 2.417905e-3, 2.188727e-3, 3.514090e-5, 0.0, 0.0, 0.0, 0.0, 0.0 ],
                [ 1.47010e-11, 1.015916e-9, 2.798589e-9, 7.308246e-8, 4.034810e-6, 4.217127e-4, 2.641997e-3, 7.052062e-3,
          3.763665e-3, 2.381035e-2, 2.873840e-2, 8.443434e-2, 1.537137e-2, 1.412648e-2, 3.337214e-4, 0.0, 0.0, 0.0, 0.0, 0.0 ],
                [ 9.82642e-12, 6.79059e-10, 1.870633e-9, 4.884978e-8, 2.696947e-6, 2.818813e-4, 2.111820e-3, 6.968125e-3, 3.736493e-3,
          2.457903e-2, 3.509891e-2, 8.189346e-2, 9.411334e-3, 7.045920e-3, 1.365560e-3, 1.490632e-5, 0.0, 0.0, 0.0, 0.0 ],
                [ 1.40367e-11, 9.70009e-10, 2.672127e-9, 6.978001e-8, 3.852484e-6, 4.026560e-4, 3.536946e-3, 1.225451e-2, 6.518136e-3,
          4.440559e-2, 6.923502e-2, 1.647387e-1, 3.265034e-2, 4.166897e-2, 1.084771e-2, 5.196002e-4, 0.0, 0.0, 0.0, 0.0 ],
                [ 3.84615e-12, 2.65790e-10, 7.32184e-10, 1.912027e-8, 1.055611e-6, 1.103310e-4, 1.847336e-3, 5.717616e-3, 3.382608e-3,
          2.164622e-2, 3.247626e-2, 6.442444e-2, 1.007016e-2, 1.314721e-2, 5.164237e-3, 5.877135e-4, 0.0, 0.0, 0.0, 0.0 ],
                [ 1.22217e-12, 8.44587e-11, 2.32662e-10, 6.075751e-9, 3.354359e-7, 3.505928e-5, 1.259095e-3, 2.981301e-3, 1.327339e-3,
          8.832828e-3, 1.292705e-2, 2.614138e-2, 4.131419e-3, 5.489045e-3, 2.801146e-3, 5.005918e-4, 0.0, 0.0, 0.0, 0.0 ]
            ]
            for t in range( chunk.NT ) :
                self.assertAlmostEqual( expected_lambda[t], chunk.time_constants[t] )
                for g in range( chunk.NGN ) :
                    self.assertAlmostEqual( expected_chi[t][g], chunk.chi(t)[g] )

            # verify string
            self.assertEqual( self.chunkDelayed + self.validSEND, chunk.to_string( 9228, 5 ) )
        
        
        # TESTS

        # When the data is provided explicitly for delayed neutron spectra
        lam = [ 0.0, 0.0, 0.0, 0.0, 0.0, 0.0 ]
        chi = [
                [ 6.40367e-13, 4.42529e-11, 1.21905e-10, 3.183440e-9, 1.757545e-7, 1.836960e-5, 5.094932e-4, 2.161763e-3,
          1.310483e-3, 5.424201e-3, 8.262024e-3, 1.267926e-2, 2.417905e-3, 2.188727e-3, 3.514090e-5, 0.0, 0.0, 0.0, 0.0, 0.0 ],
                [ 1.47010e-11, 1.015916e-9, 2.798589e-9, 7.308246e-8, 4.034810e-6, 4.217127e-4, 2.641997e-3, 7.052062e-3,
          3.763665e-3, 2.381035e-2, 2.873840e-2, 8.443434e-2, 1.537137e-2, 1.412648e-2, 3.337214e-4, 0.0, 0.0, 0.0, 0.0, 0.0 ],
                [ 9.82642e-12, 6.79059e-10, 1.870633e-9, 4.884978e-8, 2.696947e-6, 2.818813e-4, 2.111820e-3, 6.968125e-3, 3.736493e-3,
          2.457903e-2, 3.509891e-2, 8.189346e-2, 9.411334e-3, 7.045920e-3, 1.365560e-3, 1.490632e-5, 0.0, 0.0, 0.0, 0.0 ],
                [ 1.40367e-11, 9.70009e-10, 2.672127e-9, 6.978001e-8, 3.852484e-6, 4.026560e-4, 3.536946e-3, 1.225451e-2, 6.518136e-3,
          4.440559e-2, 6.923502e-2, 1.647387e-1, 3.265034e-2, 4.166897e-2, 1.084771e-2, 5.196002e-4, 0.0, 0.0, 0.0, 0.0 ],
                [ 3.84615e-12, 2.65790e-10, 7.32184e-10, 1.912027e-8, 1.055611e-6, 1.103310e-4, 1.847336e-3, 5.717616e-3, 3.382608e-3,
          2.164622e-2, 3.247626e-2, 6.442444e-2, 1.007016e-2, 1.314721e-2, 5.164237e-3, 5.877135e-4, 0.0, 0.0, 0.0, 0.0 ],
                [ 1.22217e-12, 8.44587e-11, 2.32662e-10, 6.075751e-9, 3.354359e-7, 3.505928e-5, 1.259095e-3, 2.981301e-3, 1.327339e-3,
          8.832828e-3, 1.292705e-2, 2.614138e-2, 4.131419e-3, 5.489045e-3, 2.801146e-3, 5.005918e-4, 0.0, 0.0, 0.0, 0.0 ]
        ]

        chunk_delayed = GSection( zaid = 92235, awr = 0.0, lr = 0, temp = 293.6, ng2 = 17, time_constants = lam, chi = chi )

        # then it can be verified
        verify_chunk_delayed( self, chunk_delayed )

        # When the data is read in from a string
        chunk_delayed = GSection.from_string( self.chunkDelayed + self.validSEND )

        # then it can be verified
        verify_chunk_delayed( self, chunk_delayed )
